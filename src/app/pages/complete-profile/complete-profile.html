<section class="page" [formGroup]="form">
  <h1 class="title">Termina tu cuenta</h1>

  <!-- Banners -->
  <div *ngIf="errorBanner()" class="alert alert-error" role="alert" aria-live="assertive">
    {{ errorBanner() }}
  </div>
  <div *ngIf="infoBanner()" class="alert alert-info" role="status" aria-live="polite">
    {{ infoBanner() }}
  </div>

  <!-- Avatar -->
  <div class="avatar-block">
    <div class="avatar" [class.has-img]="avatarPreview()">
      <img *ngIf="avatarPreview()" [src]="avatarPreview()" alt="Avatar" />
      <span *ngIf="!avatarPreview()" aria-hidden="true">ðŸ‘¤</span>
    </div>

    <label class="avatar-btn">
      Cambiar foto
      <input
        type="file"
        accept="image/*"
        (change)="onAvatarChange($event)"
        [attr.aria-busy]="isUploadingAvatar()"
        hidden
      />
    </label>

    <small *ngIf="isUploadingAvatar()" class="upload-feedback">Subiendo foto...</small>
  </div>

  <!-- Filtros -->
  <div class="filters">
    <div class="select">
      <label for="lugar">Lugar (Estado)</label>
      <select id="lugar" formControlName="stateCode">
        <option value="" disabled>Selecciona tu estado</option>
        <option *ngFor="let e of estadosMx" [value]="e.value">{{ e.label }}</option>
      </select>
      <small class="error" *ngIf="form.controls['stateCode'].touched && form.controls['stateCode'].invalid">
        El estado es obligatorio
      </small>
    </div>

    <div class="select">
      <label for="nivel">Nivel</label>
      <select id="nivel" formControlName="level">
        <option value="" disabled>Selecciona tu nivel</option>
        <option *ngFor="let n of niveles" [value]="n.value">{{ n.label }}</option>
      </select>
      <small class="error" *ngIf="form.controls['level'].touched && form.controls['level'].invalid">
        El nivel es obligatorio
      </small>
    </div>
  </div>

  <!-- Chips -->
  <div class="chips" role="group" aria-label="Ãreas de interÃ©s">
    <button
      type="button"
      class="chip"
      [class.active]="isSelected(tag)"
      *ngFor="let tag of tagsDisponibles; trackBy: trackByTag"
      (click)="toggleTag(tag)"
      [attr.aria-pressed]="isSelected(tag)"
    >
      <span class="chip-ico" aria-hidden="true">{{ iconFor(tag) }}</span>
      <span class="chip-label">{{ tag.name }}</span>
    </button>
  </div>

  <!-- DescripciÃ³n -->
  <div class="interests">
    <textarea
      rows="4"
      placeholder="Describe tus intereses especÃ­ficos de manera sencilla..."
      formControlName="description"
      spellcheck="true"
      autocomplete="off"
    ></textarea>
  </div>

  <!-- Acciones -->
  <div class="actions">
    <button
      class="btn"
      [disabled]="isSaving() || isUploadingAvatar() || form.invalid"
      (click)="submit()"
      [attr.aria-busy]="isSaving() || isUploadingAvatar()"
    >
      {{ isSaving() ? 'Guardando...' : (isUploadingAvatar() ? 'Subiendo foto...' : 'Guardar') }}
    </button>
  </div>
</section>
